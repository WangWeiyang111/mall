<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.situ.mall.product.dao.ProductDao">
	<sql id="product_base_select">
		SELECT ROW_ID,PRODUCT_NAME,PRODUCT_CODE,PRODUCT_PICTURE,PRODUCT_PRICE,PRODUCT_COUNT,PRODUCT_INFO,PRODUCT_STATUS,CREATE_BY,CREATE_DATE,UPDATE_BY,UPDATE_DATE FROM TB_PRODUCT WHERE ACTIVE_FLAG = 1
	</sql>

	<insert id="save" parameterType="Product" useGeneratedKeys="true" keyColumn="ROW_ID" keyProperty="rowId">
		INSERT INTO TB_PRODUCT (PRODUCT_NAME,PRODUCT_CODE,PRODUCT_PICTURE,PRODUCT_PRICE,PRODUCT_COUNT,PRODUCT_INFO,PRODUCT_STATUS,ACTIVE_FLAG,CREATE_BY,CREATE_DATE)
		VALUES(#{productName},#{productCode},#{productPicture},#{productPrice},#{productCount},#{productInfo},#{productStatus},#{activeFlag},#{createBy},#{createDate})
	</insert>

	<update id="update" parameterType="Product">
		UPDATE TB_PRODUCT
		<set>
			<if test="productName!=null">
				PRODUCT_NAME = #{productName},
			</if>
			<if test="productCode!=null">
				PRODUCT_CODE = #{productCode},
			</if>
			<if test="productPicture!=null">
				PRODUCT_PICTURE = #{productPicture},
			</if>
			<if test="productPrice!=null">
				PRODUCT_PRICE = #{productPrice},
			</if>
			<if test="productStatus!=null">
				PRODUCT_STATUS = #{productStatus},
			</if>
			<if test="productCount!=null">
				PRODUCT_COUNT = #{productCount},
			</if>
			<if test="productInfo!=null">
				PRODUCT_INFO = #{productInfo},
			</if>
			<if test="updateBy!=null">
				UPDATE_BY = #{updateBy},
			</if>
			<if test="updateDate!=null">
				UPDATE_DATE = #{updateDate},
			</if>
		</set>
		WHERE ROW_ID = #{rowId}
	</update>

	<delete id="delete">
		DELETE FROM TB_PRODUCT WHERE ROW_ID = #{rowId}
	</delete>

	<select id="get" resultType="Product">
		<include refid="product_base_select" />
		AND ROW_ID = #{rowId}
	</select>

	<select id="find" resultType="Product">
		<include refid="product_base_select" />
	</select>
	
	<select id="findByPage" resultType="Product">
		<include refid="product_base_select" />
		<include refid="search_sql" />
		LIMIT #{firstResult},#{maxResults}
	</select>
	
	<select id="getByName" resultType="Product">
		<include refid="product_base_select" />
		AND PRODUCT_NAME = #{productName}
	</select>

	<select id="getCount" resultType="java.lang.Integer">
		SELECT COUNT(ROW_ID)FROM TB_PRODUCT WHERE ACTIVE_FLAG =1
		<include refid="search_sql" />
	</select>
	
	<sql id="search_sql">
		<if test="searchProduct!=null">
			<if test="searchProduct.productStatus!=null">
				AND PRODUCT_STATUS = #{searchProduct.productStatus}
			</if>
			<if test="searchProduct.productName!=null and searchProduct.productName!=''">
				AND PRODUCT_NAME = #{searchProduct.productName}
			</if>
		</if>
	</sql>
	
</mapper>